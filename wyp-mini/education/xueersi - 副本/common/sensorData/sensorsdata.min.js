function mp_proxy(e, t, r) {
    var a = sa.autoTrackCustom[r];
    if (e[t]) {
        var s = e[t];
        e[t] = function() {
            "onLaunch" === t && (this[sa.para.name] = sa), !sa.para.autoTrackIsFirst || _.isObject(sa.para.autoTrackIsFirst) && !sa.para.autoTrackIsFirst[r] ? (s.apply(this, arguments), 
            a.apply(this, arguments)) : (!0 === sa.para.autoTrackIsFirst || _.isObject(sa.para.autoTrackIsFirst) && sa.para.autoTrackIsFirst[r]) && (a.apply(this, arguments), 
            s.apply(this, arguments));
        };
    } else e[t] = function() {
        "onLaunch" === t && (this[sa.para.name] = sa), a.apply(this, arguments);
    };
}

var _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(e) {
    return typeof e;
} : function(e) {
    return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e;
}, _ = {}, sa = {
    para: {
        name: "sensors",
        server_url: "",
        send_timeout: 1e3,
        use_client_time: !1,
        show_log: !0,
        allow_amend_share_path: !0,
        max_string_length: 300,
        datasend_timeout: 3e3,
        source_channel: [],
        autoTrack: {
            appLaunch: !0,
            appShow: !0,
            appHide: !0,
            pageShow: !0,
            pageShare: !0
        },
        is_persistent_save: !1
    }
}, logger = "object" == (void 0 === logger ? "undefined" : _typeof(logger)) ? logger : {};

logger.info = function() {
    if (sa.para.show_log && "object" == ("undefined" == typeof console ? "undefined" : _typeof(console)) && console.log) try {
        return console.log.apply(console, arguments);
    } catch (e) {
        console.log(arguments[0]);
    }
}, sa.setPara = function(e) {
    sa.para = _.extend2Lev(sa.para, e), _.isObject(sa.para.register) && _.extend(_.info.properties, sa.para.register), 
    sa.para.openid_url || (sa.para.openid_url = sa.para.server_url.replace(/([^\/])\/(sa)(\.gif){0,1}/, "$1/mp_login")), 
    "number" != typeof sa.para.send_timeout && (sa.para.send_timeout = 1e3);
    var t = {
        send_timeout: 6e3,
        max_length: 6
    };
    !0 === sa.para.batch_send ? (sa.para.batch_send = _.extend({}, t), sa.para.use_client_time = !0) : "object" == _typeof(sa.para.batch_send) && (sa.para.use_client_time = !0, 
    sa.para.batch_send = _.extend({}, t, sa.para.batch_send)), sa.para.server_url || logger.info("请使用 setPara() 方法设置 server_url 数据接收地址,详情可查看https://www.sensorsdata.cn/manual/mp_sdk_new.html#112-%E5%BC%95%E5%85%A5%E5%B9%B6%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0");
}, sa.status = {};

var ArrayProto = Array.prototype, FuncProto = Function.prototype, ObjProto = Object.prototype, slice = ArrayProto.slice, toString = ObjProto.toString, hasOwnProperty = ObjProto.hasOwnProperty, LIB_VERSION = "1.13.13", LIB_NAME = "MiniProgram", source_channel_standard = "utm_source utm_medium utm_campaign utm_content utm_term", mp_scene = {
    1001: "发现栏小程序主入口，“最近使用”列表",
    1005: "顶部搜索框的搜索结果页",
    1006: "发现栏小程序主入口搜索框的搜索结果页",
    1007: "单人聊天会话中的小程序消息卡片",
    1008: "群聊会话中的小程序消息卡片",
    1011: "扫描二维码",
    1012: "长按图片识别二维码",
    1013: "手机相册选取二维码",
    1014: "小程序模版消息",
    1017: "前往体验版的入口页",
    1019: "微信钱包",
    1020: "公众号 profile 页相关小程序列表",
    1022: "聊天顶部置顶小程序入口",
    1023: "安卓系统桌面图标",
    1024: "小程序 profile 页",
    1025: "扫描一维码",
    1026: "附近小程序列表",
    1027: "顶部搜索框搜索结果页“使用过的小程序”列表",
    1028: "我的卡包",
    1029: "卡券详情页",
    1030: "自动化测试下打开小程序",
    1031: "长按图片识别一维码",
    1032: "手机相册选取一维码",
    1034: "微信支付完成页",
    1035: "公众号自定义菜单",
    1036: "App 分享消息卡片",
    1037: "小程序打开小程序",
    1038: "从另一个小程序返回",
    1039: "摇电视",
    1042: "添加好友搜索框的搜索结果页",
    1043: "公众号模板消息",
    1044: "带 shareTicket 的小程序消息卡片（详情)",
    1045: "朋友圈广告",
    1046: "朋友圈广告详情页",
    1047: "扫描小程序码",
    1048: "长按图片识别小程序码",
    1049: "手机相册选取小程序码",
    1052: "卡券的适用门店列表",
    1053: "搜一搜的结果页",
    1054: "顶部搜索框小程序快捷入口",
    1056: "音乐播放器菜单",
    1057: "钱包中的银行卡详情页",
    1058: "公众号文章",
    1059: "体验版小程序绑定邀请页",
    1064: "微信连Wi-Fi状态栏",
    1067: "公众号文章广告",
    1068: "附近小程序列表广告",
    1069: "移动应用",
    1071: "钱包中的银行卡列表页",
    1072: "二维码收款页面",
    1073: "客服消息列表下发的小程序消息卡片",
    1074: "公众号会话下发的小程序消息卡片",
    1077: "摇周边",
    1078: "连Wi-Fi成功页",
    1079: "微信游戏中心",
    1081: "客服消息下发的文字链",
    1082: "公众号会话下发的文字链",
    1084: "朋友圈广告原生页",
    1089: "微信聊天主界面下拉",
    1090: "长按小程序右上角菜单唤出最近使用历史",
    1091: "公众号文章商品卡片",
    1092: "城市服务入口",
    1095: "小程序广告组件",
    1096: "聊天记录",
    1097: "微信支付签约页",
    1099: "页面内嵌插件",
    1102: "公众号 profile 页服务预览",
    1103: "发现栏小程序主入口，“我的小程序”列表",
    1104: "微信聊天主界面下拉，“我的小程序”栏",
    1106: "聊天主界面下拉，从顶部搜索结果页，打开小程序",
    1124: "扫“一物一码”打开小程序",
    1125: "长按图片识别“一物一码”",
    1126: "扫描手机相册中选取的“一物一码”",
    1129: "微信爬虫访问",
    1131: "浮窗打开小程序"
}, sa_referrer = "直接打开";

sa.status.referrer = "直接打开";

var mpshow_time = null, share_depth = 0, share_distinct_id = "", is_first_launch = !1;

sa.lib_version = LIB_VERSION, function() {
    FuncProto.bind;
    var e = ArrayProto.forEach, t = ArrayProto.indexOf, r = Array.isArray, a = {}, s = _.each = function(t, r, s) {
        if (null == t) return !1;
        if (e && t.forEach === e) t.forEach(r, s); else if (t.length === +t.length) {
            for (var n = 0, i = t.length; n < i; n++) if (n in t && r.call(s, t[n], n, t) === a) return !1;
        } else for (var o in t) if (hasOwnProperty.call(t, o) && r.call(s, t[o], o, t) === a) return !1;
    };
    _.logger = logger, _.extend = function(e) {
        return s(slice.call(arguments, 1), function(t) {
            for (var r in t) void 0 !== t[r] && (e[r] = t[r]);
        }), e;
    }, _.extend2Lev = function(e) {
        return s(slice.call(arguments, 1), function(t) {
            for (var r in t) void 0 !== t[r] && (_.isObject(t[r]) && _.isObject(e[r]) ? _.extend(e[r], t[r]) : e[r] = t[r]);
        }), e;
    }, _.coverExtend = function(e) {
        return s(slice.call(arguments, 1), function(t) {
            for (var r in t) void 0 !== t[r] && void 0 === e[r] && (e[r] = t[r]);
        }), e;
    }, _.isArray = r || function(e) {
        return "[object Array]" === toString.call(e);
    }, _.isFunction = function(e) {
        try {
            return /^\s*\bfunction\b/.test(e);
        } catch (e) {
            return !1;
        }
    }, _.isArguments = function(e) {
        return !(!e || !hasOwnProperty.call(e, "callee"));
    }, _.toArray = function(e) {
        return e ? e.toArray ? e.toArray() : _.isArray(e) ? slice.call(e) : _.isArguments(e) ? slice.call(e) : _.values(e) : [];
    }, _.values = function(e) {
        var t = [];
        return null == e ? t : (s(e, function(e) {
            t[t.length] = e;
        }), t);
    }, _.include = function(e, r) {
        var n = !1;
        return null == e ? n : t && e.indexOf === t ? -1 != e.indexOf(r) : (s(e, function(e) {
            if (n || (n = e === r)) return a;
        }), n);
    };
}(), _.trim = function(e) {
    return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, "");
}, _.isObject = function(e) {
    return null != e && "[object Object]" == toString.call(e);
}, _.isEmptyObject = function(e) {
    if (_.isObject(e)) {
        for (var t in e) if (hasOwnProperty.call(e, t)) return !1;
        return !0;
    }
    return !1;
}, _.isUndefined = function(e) {
    return void 0 === e;
}, _.isString = function(e) {
    return "[object String]" == toString.call(e);
}, _.isDate = function(e) {
    return "[object Date]" == toString.call(e);
}, _.isBoolean = function(e) {
    return "[object Boolean]" == toString.call(e);
}, _.isNumber = function(e) {
    return "[object Number]" == toString.call(e) && /[\d\.]+/.test(String(e));
}, _.isJSONString = function(e) {
    try {
        JSON.parse(e);
    } catch (e) {
        return !1;
    }
    return !0;
}, _.decodeURIComponent = function(e) {
    var t = "";
    try {
        t = decodeURIComponent(e);
    } catch (r) {
        t = e;
    }
    return t;
}, _.encodeDates = function(e) {
    return _.each(e, function(t, r) {
        _.isDate(t) ? e[r] = _.formatDate(t) : _.isObject(t) && (e[r] = _.encodeDates(t));
    }), e;
}, _.formatDate = function(e) {
    function t(e) {
        return e < 10 ? "0" + e : e;
    }
    return e.getFullYear() + "-" + t(e.getMonth() + 1) + "-" + t(e.getDate()) + " " + t(e.getHours()) + ":" + t(e.getMinutes()) + ":" + t(e.getSeconds()) + "." + t(e.getMilliseconds());
}, _.searchObjDate = function(e) {
    _.isObject(e) && _.each(e, function(t, r) {
        _.isObject(t) ? _.searchObjDate(e[r]) : _.isDate(t) && (e[r] = _.formatDate(t));
    });
}, _.formatString = function(e) {
    return e.length > sa.para.max_string_length ? (logger.info("字符串长度超过限制，已经做截取--" + e), 
    e.slice(0, sa.para.max_string_length)) : e;
}, _.searchObjString = function(e) {
    _.isObject(e) && _.each(e, function(t, r) {
        _.isObject(t) ? _.searchObjString(e[r]) : _.isString(t) && (e[r] = _.formatString(t));
    });
}, _.unique = function(e) {
    for (var t, r = [], a = {}, s = 0; s < e.length; s++) (t = e[s]) in a || (a[t] = !0, 
    r.push(t));
    return r;
}, _.strip_sa_properties = function(e) {
    return _.isObject(e) ? (_.each(e, function(t, r) {
        if (_.isArray(t)) {
            var a = [];
            _.each(t, function(e) {
                _.isString(e) ? a.push(e) : logger.info("您的数据-", t, "的数组里的值必须是字符串,已经将其删除");
            }), 0 !== a.length ? e[r] = a : (delete e[r], logger.info("已经删除空的数组"));
        }
        _.isString(t) || _.isNumber(t) || _.isDate(t) || _.isBoolean(t) || _.isArray(t) || (logger.info("您的数据-", t, "-格式不满足要求，我们已经将其删除"), 
        delete e[r]);
    }), e) : e;
}, _.strip_empty_properties = function(e) {
    var t = {};
    return _.each(e, function(e, r) {
        null != e && (t[r] = e);
    }), t;
}, _.utf8Encode = function(e) {
    var t, r, a, s, n = "";
    for (t = r = 0, a = (e = (e + "").replace(/\r\n/g, "\n").replace(/\r/g, "\n")).length, 
    s = 0; s < a; s++) {
        var i = e.charCodeAt(s), o = null;
        i < 128 ? r++ : o = i > 127 && i < 2048 ? String.fromCharCode(i >> 6 | 192, 63 & i | 128) : String.fromCharCode(i >> 12 | 224, i >> 6 & 63 | 128, 63 & i | 128), 
        null !== o && (r > t && (n += e.substring(t, r)), n += o, t = r = s + 1);
    }
    return r > t && (n += e.substring(t, e.length)), n;
}, _.base64Encode = function(e) {
    var t, r, a, s, n, i = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", o = 0, c = 0, u = "", p = [];
    if (!e) return e;
    e = _.utf8Encode(e);
    do {
        t = (n = e.charCodeAt(o++) << 16 | e.charCodeAt(o++) << 8 | e.charCodeAt(o++)) >> 18 & 63, 
        r = n >> 12 & 63, a = n >> 6 & 63, s = 63 & n, p[c++] = i.charAt(t) + i.charAt(r) + i.charAt(a) + i.charAt(s);
    } while (o < e.length);
    switch (u = p.join(""), e.length % 3) {
      case 1:
        u = u.slice(0, -2) + "==";
        break;

      case 2:
        u = u.slice(0, -1) + "=";
    }
    return u;
}, _.getCurrentPath = function() {
    var e = "未取到";
    try {
        var t = getCurrentPages();
        e = t[t.length - 1].route;
    } catch (e) {
        logger.info(e);
    }
    return e;
}, _.getCurrentUrl = function(e) {
    var t = _.getCurrentPath(), r = "";
    return _.isObject(e) && e.sensors_mp_encode_url_query && (r = e.sensors_mp_encode_url_query), 
    t ? r ? t + "?" + r : t : "未取到";
}, _.getPath = function(e) {
    return e = "string" == typeof e ? e.replace(/^\//, "") : "取值异常";
}, sa.initialState = {
    queue: [],
    isComplete: !1,
    systemIsComplete: !1,
    storeIsComplete: !1,
    checkIsComplete: function() {
        this.systemIsComplete && this.storeIsComplete && (this.isComplete = !0, this.queue.length > 0 && (_.each(this.queue, function(e) {
            sa[e[0]].apply(sa, slice.call(e[1]));
        }), this.queue = []));
    }
}, _.getCustomUtmFromQuery = function(e, t, r) {
    if (!_.isObject(e)) return {};
    var a = {};
    for (var s in e) -1 !== (" " + source_channel_standard + " ").indexOf(" " + s + " ") ? a[t + s] = e[s] : _.isArray(sa.para.source_channel) && _.include(sa.para.source_channel, s) && (a[r + s] = e[s]);
    return a;
}, _.getObjFromQuery = function(e) {
    var t = e.split("?"), r = {};
    return t && t[1] ? (_.each(t[1].split("&"), function(e) {
        var t = e.split("=");
        t[0] && t[1] && (r[t[0]] = t[1]);
    }), r) : {};
}, _.setStorageSync = function(e, t) {
    var r = function() {
        wx.setStorageSync(e, t);
    };
    try {
        r();
    } catch (e) {
        logger.info("set Storage fail --", e);
        try {
            r();
        } catch (e) {
            logger.info("set Storage fail again --", e);
        }
    }
}, _.getStorageSync = function(e) {
    var t = "";
    try {
        t = wx.getStorageSync(e);
    } catch (r) {
        try {
            t = wx.getStorageSync(e);
        } catch (e) {
            logger.info("getStorage fail");
        }
    }
    return t;
}, _.getMPScene = function(e) {
    return "number" == typeof e || "string" == typeof e && "" !== e ? (e = String(e), 
    mp_scene[e] || e) : "未取到值";
}, _.getShareDepth = function() {
    if ("number" == typeof share_depth && 0 !== share_depth) {
        var e = sa.store.getDistinctId(), t = sa.store.getFirstId();
        return !share_distinct_id || share_distinct_id !== e && share_distinct_id !== t ? share_depth + 1 : share_depth;
    }
    return 1;
}, _.setShareInfo = function(e, t) {
    var r = {};
    if (!(e && _.isObject(e.query) && e.query.sampshare)) return {};
    if (r = _.decodeURIComponent(e.query.sampshare), !_.isJSONString(r)) return {};
    var a = (r = JSON.parse(r)).d, s = r.p, n = r.i;
    "string" == typeof n ? (t.$share_distinct_id = n, share_distinct_id = n) : t.$share_distinct_id = "取值异常", 
    "number" == typeof a ? (t.$share_depth = a, share_depth = a) : t.$share_depth = "-1", 
    t.$share_url_path = "string" == typeof s ? s : "取值异常";
}, _.getShareInfo = function() {
    return JSON.stringify({
        i: sa.store.getDistinctId() || "取值异常",
        p: _.getCurrentPath(),
        d: _.getShareDepth()
    });
}, _.detectOptionQuery = function(e) {
    if (!e || !_.isObject(e.query)) return {};
    var t = {};
    return t.query = _.extend({}, e.query), "string" == typeof t.query.scene && (t.scene = t.query.scene, 
    t.query = {}, delete t.query.scene), e.query.scancode_time && "1011" === String(e.scene) && (t.q = String(t.query.q), 
    delete t.query.q, delete t.query.scancode_time), t;
}, _.getMixedQuery = function(e) {
    var t = _.detectOptionQuery(e), r = t.scene, a = t.q, s = t.query;
    for (var n in s) s[n] = _.decodeURIComponent(s[n]);
    return r && (r = -1 !== (r = _.decodeURIComponent(r)).indexOf("?") ? "?" + r.replace(/\?/g, "") : "?" + r, 
    _.extend(s, _.getObjFromQuery(r))), a && _.extend(s, _.getObjFromQuery(_.decodeURIComponent(a))), 
    s;
}, _.setUtm = function(e, t) {
    var r = {}, a = _.getMixedQuery(e), s = _.getCustomUtmFromQuery(a, "$", "_"), n = _.getCustomUtmFromQuery(a, "$latest_", "_latest_");
    return r.pre1 = s, r.pre2 = n, _.extend(t, s), r;
}, _.wxrequest = function(e) {
    var t = wx.request(e);
    setTimeout(function() {
        _.isObject(t) && _.isFunction(t.abort) && t.abort();
    }, sa.para.datasend_timeout);
}, _.info = {
    currentProps: {},
    properties: {
        $lib: LIB_NAME,
        $lib_version: String(LIB_VERSION)
    },
    getSystem: function() {
        function e() {
            wx.getSystemInfo({
                success: function(e) {
                    var r, a;
                    t.$manufacturer = e.brand, t.$model = e.model, t.$screen_width = Number(e.screenWidth), 
                    t.$screen_height = Number(e.screenHeight), t.$os = (r = e.platform, "ios" === (a = r.toLowerCase()) ? "iOS" : "android" === a ? "Android" : r), 
                    t.$os_version = e.system.indexOf(" ") > -1 ? e.system.split(" ")[1] : e.system;
                },
                complete: function() {
                    sa.initialState.systemIsComplete = !0, sa.initialState.checkIsComplete();
                }
            });
        }
        var t = this.properties;
        wx.getNetworkType({
            success: function(e) {
                t.$network_type = e.networkType;
            },
            complete: e
        });
    }
}, sa._ = _, sa.prepareData = function(e, t) {
    var r = {
        distinct_id: this.store.getDistinctId(),
        lib: {
            $lib: LIB_NAME,
            $lib_method: "code",
            $lib_version: String(LIB_VERSION)
        },
        properties: {}
    };
    _.extend(r, this.store.getUnionId(), e), _.isObject(e.properties) && !_.isEmptyObject(e.properties) && _.extend(r.properties, e.properties), 
    e.type && "profile" === e.type.slice(0, 7) || (sa.para.batch_send && (r._track_id = Number(String(Math.random()).slice(2, 5) + String(Math.random()).slice(2, 4) + String(Date.now()).slice(-4))), 
    r.properties = _.extend({}, _.info.properties, sa.store.getProps(), _.info.currentProps, r.properties), 
    "object" == _typeof(sa.store._state) && "number" == typeof sa.store._state.first_visit_day_time && sa.store._state.first_visit_day_time > new Date().getTime() ? r.properties.$is_first_day = !0 : r.properties.$is_first_day = !1), 
    r.properties.$time && _.isDate(r.properties.$time) ? (r.time = 1 * r.properties.$time, 
    delete r.properties.$time) : sa.para.use_client_time && (r.time = 1 * new Date()), 
    _.searchObjDate(r), _.searchObjString(r), logger.info(r), sa.sendStrategy.send(r);
}, sa.store = {
    verifyDistinctId: function(e) {
        return "number" == typeof e && (e = String(e), /^\d+$/.test(e) || (e = "unexpected_id")), 
        "string" == typeof e && "" !== e || (e = "unexpected_id"), e;
    },
    storageInfo: null,
    getUUID: function() {
        return Date.now() + "-" + Math.floor(1e7 * Math.random()) + "-" + Math.random().toString(16).replace(".", "") + "-" + String(31242 * Math.random()).replace(".", "").slice(0, 8);
    },
    getStorage: function() {
        return this.storageInfo ? this.storageInfo : (this.storageInfo = sa._.getStorageSync("sensorsdata2015_wechat") || "", 
        this.storageInfo);
    },
    _state: {},
    mem: {
        mdata: [],
        getLength: function() {
            return this.mdata.length;
        },
        add: function(e) {
            this.mdata.push(e);
        },
        clear: function(e) {
            this.mdata.splice(0, e);
        }
    },
    toState: function(e) {
        var t = null;
        _.isJSONString(e) ? (t = JSON.parse(e)).distinct_id ? this._state = t : this.set("distinct_id", this.getUUID()) : _.isObject(e) && (t = e).distinct_id ? this._state = t : this.set("distinct_id", this.getUUID());
    },
    getFirstId: function() {
        return this._state.first_id;
    },
    getDistinctId: function() {
        return this._state.distinct_id;
    },
    getUnionId: function() {
        var e = {};
        return this._state.first_id && this._state.distinct_id ? (e.login_id = this._state.distinct_id, 
        e.anonymous_id = this._state.first_id) : e.anonymous_id = this._state.distinct_id, 
        e;
    },
    getProps: function() {
        return this._state.props || {};
    },
    setProps: function(e, t) {
        var r = this._state.props || {};
        t ? this.set("props", e) : (_.extend(r, e), this.set("props", r));
    },
    set: function(e, t) {
        var r = {};
        for (var a in "string" == typeof e ? r[e] = t : "object" == (void 0 === e ? "undefined" : _typeof(e)) && (r = e), 
        this._state = this._state || {}, r) this._state[a] = r[a];
        this.save();
    },
    change: function(e, t) {
        this._state[e] = t;
    },
    save: function() {
        sa._.setStorageSync("sensorsdata2015_wechat", this._state);
    },
    init: function() {
        var e = this.getStorage();
        if (e) this.toState(e); else {
            is_first_launch = !0;
            var t = new Date(), r = t.getTime();
            t.setHours(23), t.setMinutes(59), t.setSeconds(60), sa.setOnceProfile({
                $first_visit_time: new Date()
            }), this.set({
                distinct_id: this.getUUID(),
                first_visit_time: r,
                first_visit_day_time: t.getTime()
            });
        }
    }
}, sa.setProfile = function(e, t) {
    sa.prepareData({
        type: "profile_set",
        properties: e
    }, t);
}, sa.setOnceProfile = function(e, t) {
    sa.prepareData({
        type: "profile_set_once",
        properties: e
    }, t);
}, sa.appendProfile = function(e, t) {
    if (!_.isObject(e)) return !1;
    _.each(e, function(t, r) {
        _.isString(t) ? e[r] = [ t ] : _.isArray(t) || (delete e[r], logger.info("appendProfile属性的值必须是字符串或者数组"));
    }), sa.prepareData({
        type: "profile_append",
        properties: e
    }, t);
}, sa.incrementProfile = function(e, t) {
    if (!_.isObject(e)) return !1;
    var r = e;
    _.isString(e) && ((e = {})[r] = 1), sa.prepareData({
        type: "profile_increment",
        properties: e
    }, t);
}, sa.track = function(e, t, r) {
    this.prepareData({
        type: "track",
        event: e,
        properties: t
    }, r);
}, sa.identify = function(e, t) {
    if ("string" != typeof e && "number" != typeof e) return !1;
    e = sa.store.verifyDistinctId(e);
    var r = sa.store.getFirstId();
    !0 === t ? r ? sa.store.set("first_id", e) : sa.store.set("distinct_id", e) : r ? sa.store.change("first_id", e) : sa.store.change("distinct_id", e);
}, sa.trackSignup = function(e, t, r, a) {
    var s = sa.store.getFirstId() || sa.store.getDistinctId();
    sa.store.set("distinct_id", e), sa.prepareData({
        original_id: s,
        distinct_id: e,
        type: "track_signup",
        event: t,
        properties: r
    }, a);
}, sa.registerApp = function(e) {
    _.isObject(e) && !_.isEmptyObject(e) && (_.info.currentProps = _.extend(_.info.currentProps, e));
}, sa.register = function(e) {
    _.isObject(e) && !_.isEmptyObject(e) && sa.store.setProps(e);
}, sa.clearAllRegister = function() {
    sa.store.setProps({}, !0);
}, sa.login = function(e) {
    if ("string" != typeof e && "number" != typeof e) return !1;
    e = sa.store.verifyDistinctId(e);
    var t = sa.store.getFirstId(), r = sa.store.getDistinctId();
    e !== r && (t ? sa.trackSignup(e, "$SignUp") : (sa.store.set("first_id", r), sa.trackSignup(e, "$SignUp")));
}, sa.openid = {
    getRequest: function(e) {
        wx.login({
            success: function(t) {
                t.code && sa.para.appid && sa.para.openid_url ? _.wxrequest({
                    url: sa.para.openid_url + "&code=" + t.code + "&appid=" + sa.para.appid,
                    method: "GET",
                    complete: function(t) {
                        _.isObject(t) && _.isObject(t.data) && t.data.openid ? e(t.data.openid) : e();
                    }
                }) : e();
            }
        });
    },
    getWXStorage: function() {
        var e = sa.store.getStorage();
        if (e && _.isObject(e)) return e.openid;
    },
    getOpenid: function(e) {
        if (!sa.para.appid) return e(), !1;
        var t = this.getWXStorage();
        t ? e(t) : this.getRequest(e);
    }
}, sa.initial = function() {
    this._.info.getSystem(), this.store.init();
}, sa.init = function(e) {
    if (!0 === this.hasInit) return !1;
    this.hasInit = !0, sa.setPara(e), sa.para.batch_send && sa.sendStrategy.batchInterval(), 
    sa.initialState.storeIsComplete = !0, sa.initialState.checkIsComplete();
}, sa.getPresetProperties = function() {
    if (_.info && _.info.properties && _.info.properties.$lib) {
        var e = {};
        _.each(_.info.currentProps, function(t, r) {
            0 === r.indexOf("$") && (e[r] = t);
        });
        var t = _.extend(e, {
            $url_path: _.getCurrentPath()
        }, _.info.properties, sa.store.getProps());
        return delete t.$lib, t;
    }
    return {};
}, _.autoExeQueue = function() {
    return {
        items: [],
        enqueue: function(e) {
            this.items.push(e), this.start();
        },
        dequeue: function() {
            return this.items.shift();
        },
        getCurrentItem: function() {
            return this.items[0];
        },
        isRun: !1,
        start: function() {
            this.items.length > 0 && !this.isRun && (this.isRun = !0, this.getCurrentItem().start());
        },
        close: function() {
            this.dequeue(), this.isRun = !1, this.start();
        }
    };
}, sa.requestQueue = function(e) {
    this.url = e.url;
}, sa.requestQueue.prototype.isEnd = function() {
    this.received || (this.received = !0, this.close());
}, sa.requestQueue.prototype.start = function() {
    var e = this;
    setTimeout(function() {
        e.isEnd();
    }, sa.para.send_timeout), _.wxrequest({
        url: this.url,
        method: "GET",
        complete: function() {
            e.isEnd();
        }
    });
}, sa.dataQueue = _.autoExeQueue(), sa.sendStrategy = {
    dataHasSend: !0,
    dataHasChange: !1,
    onAppHide: function() {
        sa.para.batch_send && this.batchSend();
    },
    send: function(e) {
        if (!sa.para.server_url) return !1;
        if (sa.para.batch_send) {
            if (this.dataHasChange = !0, sa.store.mem.getLength() >= 300) return logger.info("数据量存储过大，有异常"), 
            !1;
            sa.store.mem.add(e), sa.store.mem.getLength() >= sa.para.batch_send.max_length && this.batchSend();
        } else this.queueSend(e);
    },
    queueSend: function(e) {
        e = JSON.stringify(e), e = -1 !== sa.para.server_url.indexOf("?") ? sa.para.server_url + "&data=" + encodeURIComponent(_.base64Encode(e)) : sa.para.server_url + "?data=" + encodeURIComponent(_.base64Encode(e));
        var t = new sa.requestQueue({
            url: e
        });
        t.close = function() {
            sa.dataQueue.close();
        }, sa.dataQueue.enqueue(t);
    },
    wxrequest: function(e) {
        if (_.isArray(e.data) && e.data.length > 0) {
            var t = Date.now();
            e.data.forEach(function(e) {
                e._flush_time = t;
            }), e.data = JSON.stringify(e.data), _.wxrequest({
                url: sa.para.server_url,
                method: "POST",
                dataType: "text",
                data: "data_list=" + encodeURIComponent(_.base64Encode(e.data)),
                success: function() {
                    e.success(e.len);
                }
            });
        } else e.success(e.len);
    },
    batchSend: function() {
        if (this.dataHasSend) {
            var e = sa.store.mem.mdata, t = e.length;
            t > 0 && (this.dataHasSend = !1, this.wxrequest({
                data: e,
                len: t,
                success: this.batchRemove.bind(this)
            }));
        }
    },
    batchRemove: function(e) {
        sa.store.mem.clear(e), this.dataHasSend = !0, this.dataHasChange = !0, this.batchWrite();
    },
    is_first_batch_write: !0,
    batchWrite: function() {
        var e = this;
        this.dataHasChange && (this.is_first_batch_write && (this.is_first_batch_write = !1, 
        setTimeout(function() {
            e.batchSend();
        }, 1e3)), this.dataHasChange = !1, sa._.setStorageSync("sensors_mp_prepare_data", sa.store.mem.mdata));
    },
    batchInterval: function() {
        var e = this;
        !function t() {
            setTimeout(function() {
                e.batchWrite(), t();
            }, 500);
        }(), function t() {
            setTimeout(function() {
                e.batchSend(), t();
            }, sa.para.batch_send.send_timeout);
        }();
    }
}, sa.setOpenid = function(e, t) {
    sa.store.set("openid", e), t ? sa.store.set("distinct_id", e) : sa.identify(e, !0);
}, sa.initWithOpenid = function(e, t) {
    (e = e || {}).appid && (sa.para.appid = e.appid), sa.openid.getOpenid(function(r) {
        r && sa.setOpenid(r, e.isCoverLogin), t && _.isFunction(t) && t(r), sa.init(e);
    });
}, _.each([ "setProfile", "setOnceProfile", "track", "register", "clearAllRegister", "quick", "incrementProfile", "appendProfile" ], function(e) {
    var t = sa[e];
    sa[e] = function() {
        sa.initialState.isComplete ? t.apply(sa, arguments) : sa.initialState.queue.push([ e, arguments ]);
    };
}), _.setQuery = function(e, t) {
    if (e && _.isObject(e) && !_.isEmptyObject(e)) {
        var r = [];
        return _.each(e, function(e, a) {
            "q" === a && _.isString(e) && 0 === e.indexOf("http") || "scene" === a || (t ? r.push(a + "=" + e) : r.push(a + "=" + _.decodeURIComponent(e)));
        }), r.join("&");
    }
    return "";
}, _.getUtmFromPage = function() {
    var e = {};
    try {
        var t = getCurrentPages(), r = t[t.length - 1].options;
        e = _.getCustomUtmFromQuery(r, "$", "_");
    } catch (e) {
        logger.info(e);
    }
    return e;
}, sa.autoTrackCustom = {
    trackCustom: function(e, t, r) {
        var a = sa.para.autoTrack[e], s = "";
        sa.para.autoTrack && a && ("function" == typeof a ? (s = a(), _.isObject(s) && _.extend(t, s)) : _.isObject(a) && (_.extend(t, a), 
        sa.para.autoTrack[e] = !0), sa.track(r, t));
    },
    appLaunch: function(e, t) {
        "object" != _typeof(this) || this.trackCustom || (this[sa.para.name] = sa);
        var r = {};
        e && e.path && (r.$url_path = _.getPath(e.path)), _.setShareInfo(e, r);
        var a = _.setUtm(e, r);
        is_first_launch ? (r.$is_first_time = !0, _.isEmptyObject(a.pre1) || sa.setOnceProfile(a.pre1)) : r.$is_first_time = !1, 
        _.isEmptyObject(a.pre2) || (!0 === sa.para.is_persistent_save ? sa.register(a.pre2) : sa.registerApp(a.pre2)), 
        e.scene = e.scene || "未取到值", r.$scene = _.getMPScene(e.scene), sa.registerApp({
            $latest_scene: r.$scene
        }), r.$url_query = _.setQuery(e.query), t ? (r = _.extend(r, t), sa.track("$MPLaunch", r)) : sa.para.autoTrack && sa.para.autoTrack.appLaunch && sa.autoTrackCustom.trackCustom("appLaunch", r, "$MPLaunch");
    },
    appShow: function(e, t) {
        var r = {};
        mpshow_time = new Date().getTime(), e && e.path && (r.$url_path = _.getPath(e.path)), 
        _.setShareInfo(e, r);
        var a = _.setUtm(e, r);
        _.isEmptyObject(a.pre2) || (!0 === sa.para.is_persistent_save ? sa.register(a.pre2) : sa.registerApp(a.pre2)), 
        e.scene = e.scene || "未取到值", r.$scene = _.getMPScene(e.scene), sa.registerApp({
            $latest_scene: r.$scene
        }), r.$url_query = _.setQuery(e.query), t ? (r = _.extend(r, t), sa.track("$MPShow", r)) : sa.para.autoTrack && sa.para.autoTrack.appShow && sa.autoTrackCustom.trackCustom("appShow", r, "$MPShow");
    },
    appHide: function(e) {
        var t = new Date().getTime(), r = {};
        r.$url_path = _.getCurrentPath(), mpshow_time && t - mpshow_time > 0 && (t - mpshow_time) / 36e5 < 24 && (r.event_duration = (t - mpshow_time) / 1e3), 
        e ? (r = _.extend(r, e), sa.track("$MPHide", r)) : sa.para.autoTrack && sa.para.autoTrack.appHide && sa.autoTrackCustom.trackCustom("appHide", r, "$MPHide"), 
        sa.sendStrategy.onAppHide();
    },
    pageLoad: function(e) {
        e && _.isObject(e) && (this.sensors_mp_url_query = _.setQuery(e), this.sensors_mp_encode_url_query = _.setQuery(e, !0));
    },
    pageShow: function() {
        var e = {}, t = _.getCurrentPath();
        e.$referrer = sa_referrer, e.$url_path = t, sa.status.last_referrer = sa_referrer, 
        e.$url_query = this.sensors_mp_url_query ? this.sensors_mp_url_query : "", e = _.extend(e, _.getUtmFromPage()), 
        sa.para.onshow ? sa.para.onshow(sa, t, this) : sa.para.autoTrack && sa.para.autoTrack.pageShow && sa.autoTrackCustom.trackCustom("pageShow", e, "$MPViewScreen"), 
        sa_referrer = t, sa.status.referrer = t;
    },
    pageShare: function(e, t) {
        var r = e.onShareAppMessage;
        e.onShareAppMessage = function() {
            var e = r.apply(this, arguments);
            return sa.para.autoTrack && sa.para.autoTrack.pageShare && sa.autoTrackCustom.trackCustom("pageShare", {
                $url_path: _.getCurrentPath(),
                $share_depth: _.getShareDepth()
            }, "$MPShare"), sa.para.allow_amend_share_path && ("object" != (void 0 === e ? "undefined" : _typeof(e)) && ((e = {}).path = _.getCurrentUrl(this)), 
            "object" != (void 0 === e ? "undefined" : _typeof(e)) || void 0 !== e.path && "" !== e.path || (e.path = _.getCurrentUrl(this)), 
            "object" == (void 0 === e ? "undefined" : _typeof(e)) && "string" == typeof e.path && (-1 === e.path.indexOf("?") ? e.path = e.path + "?" : "&" !== e.path.slice(-1) && (e.path = e.path + "&")), 
            e.path = e.path + "sampshare=" + encodeURIComponent(_.getShareInfo())), e;
        };
    }
}, sa.quick = function() {
    var e = arguments[0], t = arguments[1], r = arguments[2], a = _.isObject(r) ? r : {};
    if ("getAnonymousID" === e) {
        if (!_.isEmptyObject(sa.store._state)) return sa.store._state.first_id ? sa.store._state.first_id : sa.store._state.distinct_id;
        logger.info("请先初始化SDK");
    } else "appLaunch" === e || "appShow" === e ? t ? sa.autoTrackCustom[e](t, a) : logger.info("App的launch和show，在sensors.quick第二个参数必须传入App的options参数") : "appHide" === e && (a = _.isObject(t) ? t : {}, 
    sa.autoTrackCustom[e](a));
};

var oldApp = App;

App = function(e) {
    mp_proxy(e, "onLaunch", "appLaunch"), mp_proxy(e, "onShow", "appShow"), mp_proxy(e, "onHide", "appHide"), 
    oldApp.apply(this, arguments);
};

var oldPage = Page;

Page = function(e) {
    mp_proxy(e, "onLoad", "pageLoad"), mp_proxy(e, "onShow", "pageShow"), "function" == typeof e.onShareAppMessage && sa.autoTrackCustom.pageShare(e), 
    oldPage.apply(this, arguments);
};

var oldComponent = Component;

Component = function(e) {
    try {
        e.methods = e.methods || {}, mp_proxy(e.methods, "onLoad", "pageLoad"), mp_proxy(e.methods, "onShow", "pageShow"), 
        "function" == typeof e.methods.onShareAppMessage && sa.autoTrackCustom.pageShare(e.methods), 
        oldComponent.apply(this, arguments);
    } catch (e) {
        oldComponent.apply(this, arguments);
    }
}, sa.initial(), module.exports = sa;