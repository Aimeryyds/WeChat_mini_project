function t(t, e, i) {
    var a = n.autoTrackCustom[i];
    if (t[e]) {
        var s = t[e];
        t[e] = function() {
            "onLaunch" === e && (this[n.para.name] = n), !n.para.autoTrackIsFirst || r.isObject(n.para.autoTrackIsFirst) && !n.para.autoTrackIsFirst[i] ? (s.apply(this, arguments), 
            a.apply(this, arguments)) : (!0 === n.para.autoTrackIsFirst || r.isObject(n.para.autoTrackIsFirst) && n.para.autoTrackIsFirst[i]) && (a.apply(this, arguments), 
            s.apply(this, arguments));
        };
    } else t[e] = function() {
        "onLaunch" === e && (this[n.para.name] = n), a.apply(this, arguments);
    };
}

var e = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(t) {
    return typeof t;
} : function(t) {
    return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t;
}, r = {}, n = {
    para: {
        name: "sensors",
        server_url: "",
        send_timeout: 1e3,
        use_client_time: !1,
        show_log: !0,
        allow_amend_share_path: !0,
        max_string_length: 300,
        datasend_timeout: 3e3,
        source_channel: [],
        autoTrack: {
            appLaunch: !0,
            appShow: !0,
            appHide: !0,
            pageShow: !0,
            pageShare: !0
        }
    }
}, i = "object" == (void 0 === i ? "undefined" : e(i)) ? i : {};

i.info = function() {
    if (n.para.show_log && "object" == ("undefined" == typeof console ? "undefined" : e(console)) && console.log) try {
        return console.log.apply(console, arguments);
    } catch (t) {
        console.log(arguments[0]);
    }
}, n.setPara = function(t) {
    n.para = r.extend2Lev(n.para, t), r.isObject(n.para.register) && r.extend(r.info.properties, n.para.register), 
    n.para.openid_url || (n.para.openid_url = n.para.server_url.replace(/([^\/])\/(sa)(\.gif){0,1}/, "$1/mp_login")), 
    "number" != typeof n.para.send_timeout && (n.para.send_timeout = 1e3);
    var a = {
        send_timeout: 6e3,
        max_length: 6
    };
    !0 === n.para.batch_send ? (n.para.batch_send = r.extend({}, a), n.para.use_client_time = !0) : "object" == e(n.para.batch_send) && (n.para.use_client_time = !0, 
    n.para.batch_send = r.extend({}, a, n.para.batch_send)), n.para.server_url || i.info("请使用 setPara() 方法设置 server_url 数据接收地址,详情可查看https://www.sensorsdata.cn/manual/mp_sdk_new.html#112-%E5%BC%95%E5%85%A5%E5%B9%B6%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0");
}, n.status = {};

var a = Array.prototype, s = Function.prototype, o = Object.prototype, c = a.slice, u = o.toString, p = o.hasOwnProperty, f = {
    1001: "发现栏小程序主入口，“最近使用”列表",
    1005: "顶部搜索框的搜索结果页",
    1006: "发现栏小程序主入口搜索框的搜索结果页",
    1007: "单人聊天会话中的小程序消息卡片",
    1008: "群聊会话中的小程序消息卡片",
    1011: "扫描二维码",
    1012: "长按图片识别二维码",
    1013: "手机相册选取二维码",
    1014: "小程序模版消息",
    1017: "前往体验版的入口页",
    1019: "微信钱包",
    1020: "公众号 profile 页相关小程序列表",
    1022: "聊天顶部置顶小程序入口",
    1023: "安卓系统桌面图标",
    1024: "小程序 profile 页",
    1025: "扫描一维码",
    1026: "附近小程序列表",
    1027: "顶部搜索框搜索结果页“使用过的小程序”列表",
    1028: "我的卡包",
    1029: "卡券详情页",
    1030: "自动化测试下打开小程序",
    1031: "长按图片识别一维码",
    1032: "手机相册选取一维码",
    1034: "微信支付完成页",
    1035: "公众号自定义菜单",
    1036: "App 分享消息卡片",
    1037: "小程序打开小程序",
    1038: "从另一个小程序返回",
    1039: "摇电视",
    1042: "添加好友搜索框的搜索结果页",
    1043: "公众号模板消息",
    1044: "带 shareTicket 的小程序消息卡片（详情)",
    1045: "朋友圈广告",
    1046: "朋友圈广告详情页",
    1047: "扫描小程序码",
    1048: "长按图片识别小程序码",
    1049: "手机相册选取小程序码",
    1052: "卡券的适用门店列表",
    1053: "搜一搜的结果页",
    1054: "顶部搜索框小程序快捷入口",
    1056: "音乐播放器菜单",
    1057: "钱包中的银行卡详情页",
    1058: "公众号文章",
    1059: "体验版小程序绑定邀请页",
    1064: "微信连Wi-Fi状态栏",
    1067: "公众号文章广告",
    1068: "附近小程序列表广告",
    1069: "移动应用",
    1071: "钱包中的银行卡列表页",
    1072: "二维码收款页面",
    1073: "客服消息列表下发的小程序消息卡片",
    1074: "公众号会话下发的小程序消息卡片",
    1077: "摇周边",
    1078: "连Wi-Fi成功页",
    1079: "微信游戏中心",
    1081: "客服消息下发的文字链",
    1082: "公众号会话下发的文字链",
    1084: "朋友圈广告原生页",
    1089: "微信聊天主界面下拉",
    1090: "长按小程序右上角菜单唤出最近使用历史",
    1091: "公众号文章商品卡片",
    1092: "城市服务入口",
    1095: "小程序广告组件",
    1096: "聊天记录",
    1097: "微信支付签约页",
    1099: "页面内嵌插件",
    1102: "公众号 profile 页服务预览",
    1103: "发现栏小程序主入口，“我的小程序”列表",
    1104: "微信聊天主界面下拉，“我的小程序”栏",
    1124: "扫“一物一码”打开小程序",
    1125: "长按图片识别“一物一码”",
    1126: "扫描手机相册中选取的“一物一码”",
    1129: "微信爬虫访问"
}, h = "直接打开";

n.status.referrer = "直接打开";

var d = null, l = 0, g = "", m = !1;

n.lib_version = "1.13.8", function() {
    s.bind;
    var t = a.forEach, e = a.indexOf, n = Array.isArray, o = {}, f = r.each = function(e, r, n) {
        if (null == e) return !1;
        if (t && e.forEach === t) e.forEach(r, n); else if (e.length === +e.length) {
            for (var i = 0, a = e.length; i < a; i++) if (i in e && r.call(n, e[i], i, e) === o) return !1;
        } else for (var s in e) if (p.call(e, s) && r.call(n, e[s], s, e) === o) return !1;
    };
    r.logger = i, r.extend = function(t) {
        return f(c.call(arguments, 1), function(e) {
            for (var r in e) void 0 !== e[r] && (t[r] = e[r]);
        }), t;
    }, r.extend2Lev = function(t) {
        return f(c.call(arguments, 1), function(e) {
            for (var n in e) void 0 !== e[n] && (r.isObject(e[n]) && r.isObject(t[n]) ? r.extend(t[n], e[n]) : t[n] = e[n]);
        }), t;
    }, r.coverExtend = function(t) {
        return f(c.call(arguments, 1), function(e) {
            for (var r in e) void 0 !== e[r] && void 0 === t[r] && (t[r] = e[r]);
        }), t;
    }, r.isArray = n || function(t) {
        return "[object Array]" === u.call(t);
    }, r.isFunction = function(t) {
        try {
            return /^\s*\bfunction\b/.test(t);
        } catch (t) {
            return !1;
        }
    }, r.isArguments = function(t) {
        return !(!t || !p.call(t, "callee"));
    }, r.toArray = function(t) {
        return t ? t.toArray ? t.toArray() : r.isArray(t) ? c.call(t) : r.isArguments(t) ? c.call(t) : r.values(t) : [];
    }, r.values = function(t) {
        var e = [];
        return null == t ? e : (f(t, function(t) {
            e[e.length] = t;
        }), e);
    }, r.include = function(t, r) {
        var n = !1;
        return null == t ? n : e && t.indexOf === e ? -1 != t.indexOf(r) : (f(t, function(t) {
            if (n || (n = t === r)) return o;
        }), n);
    };
}(), r.trim = function(t) {
    return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, "");
}, r.isObject = function(t) {
    return null != t && "[object Object]" == u.call(t);
}, r.isEmptyObject = function(t) {
    if (r.isObject(t)) {
        for (var e in t) if (p.call(t, e)) return !1;
        return !0;
    }
    return !1;
}, r.isUndefined = function(t) {
    return void 0 === t;
}, r.isString = function(t) {
    return "[object String]" == u.call(t);
}, r.isDate = function(t) {
    return "[object Date]" == u.call(t);
}, r.isBoolean = function(t) {
    return "[object Boolean]" == u.call(t);
}, r.isNumber = function(t) {
    return "[object Number]" == u.call(t) && /[\d\.]+/.test(String(t));
}, r.isJSONString = function(t) {
    try {
        JSON.parse(t);
    } catch (t) {
        return !1;
    }
    return !0;
}, r.decodeURIComponent = function(t) {
    var e = "";
    try {
        e = decodeURIComponent(t);
    } catch (r) {
        e = t;
    }
    return e;
}, r.encodeDates = function(t) {
    return r.each(t, function(e, n) {
        r.isDate(e) ? t[n] = r.formatDate(e) : r.isObject(e) && (t[n] = r.encodeDates(e));
    }), t;
}, r.formatDate = function(t) {
    function e(t) {
        return t < 10 ? "0" + t : t;
    }
    return t.getFullYear() + "-" + e(t.getMonth() + 1) + "-" + e(t.getDate()) + " " + e(t.getHours()) + ":" + e(t.getMinutes()) + ":" + e(t.getSeconds()) + "." + e(t.getMilliseconds());
}, r.searchObjDate = function(t) {
    r.isObject(t) && r.each(t, function(e, n) {
        r.isObject(e) ? r.searchObjDate(t[n]) : r.isDate(e) && (t[n] = r.formatDate(e));
    });
}, r.formatString = function(t) {
    return t.length > n.para.max_string_length ? (i.info("字符串长度超过限制，已经做截取--" + t), t.slice(0, n.para.max_string_length)) : t;
}, r.searchObjString = function(t) {
    r.isObject(t) && r.each(t, function(e, n) {
        r.isObject(e) ? r.searchObjString(t[n]) : r.isString(e) && (t[n] = r.formatString(e));
    });
}, r.unique = function(t) {
    for (var e, r = [], n = {}, i = 0; i < t.length; i++) (e = t[i]) in n || (n[e] = !0, 
    r.push(e));
    return r;
}, r.strip_sa_properties = function(t) {
    return r.isObject(t) ? (r.each(t, function(e, n) {
        if (r.isArray(e)) {
            var a = [];
            r.each(e, function(t) {
                r.isString(t) ? a.push(t) : i.info("您的数据-", e, "的数组里的值必须是字符串,已经将其删除");
            }), 0 !== a.length ? t[n] = a : (delete t[n], i.info("已经删除空的数组"));
        }
        r.isString(e) || r.isNumber(e) || r.isDate(e) || r.isBoolean(e) || r.isArray(e) || (i.info("您的数据-", e, "-格式不满足要求，我们已经将其删除"), 
        delete t[n]);
    }), t) : t;
}, r.strip_empty_properties = function(t) {
    var e = {};
    return r.each(t, function(t, r) {
        null != t && (e[r] = t);
    }), e;
}, r.utf8Encode = function(t) {
    var e, r, n, i, a = "";
    for (e = r = 0, n = (t = (t + "").replace(/\r\n/g, "\n").replace(/\r/g, "\n")).length, 
    i = 0; i < n; i++) {
        var s = t.charCodeAt(i), o = null;
        s < 128 ? r++ : o = s > 127 && s < 2048 ? String.fromCharCode(s >> 6 | 192, 63 & s | 128) : String.fromCharCode(s >> 12 | 224, s >> 6 & 63 | 128, 63 & s | 128), 
        null !== o && (r > e && (a += t.substring(e, r)), a += o, e = r = i + 1);
    }
    return r > e && (a += t.substring(e, t.length)), a;
}, r.base64Encode = function(t) {
    var e, n, i, a, s, o = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", c = 0, u = 0, p = "", f = [];
    if (!t) return t;
    t = r.utf8Encode(t);
    do {
        e = (s = t.charCodeAt(c++) << 16 | t.charCodeAt(c++) << 8 | t.charCodeAt(c++)) >> 18 & 63, 
        n = s >> 12 & 63, i = s >> 6 & 63, a = 63 & s, f[u++] = o.charAt(e) + o.charAt(n) + o.charAt(i) + o.charAt(a);
    } while (c < t.length);
    switch (p = f.join(""), t.length % 3) {
      case 1:
        p = p.slice(0, -2) + "==";
        break;

      case 2:
        p = p.slice(0, -1) + "=";
    }
    return p;
}, r.getCurrentPath = function() {
    var t = "未取到";
    try {
        var e = getCurrentPages();
        t = e[e.length - 1].route;
    } catch (t) {
        i.info(t);
    }
    return t;
}, r.getCurrentUrl = function(t) {
    var e = r.getCurrentPath(), n = "";
    return r.isObject(t) && t.sensors_mp_url_query && (n = t.sensors_mp_url_query), 
    e ? n ? e + "?" + n : e : "未取到";
}, r.getPath = function(t) {
    return t = "string" == typeof t ? t.replace(/^\//, "") : "取值异常";
}, n.initialState = {
    queue: [],
    isComplete: !1,
    systemIsComplete: !1,
    storeIsComplete: !1,
    checkIsComplete: function() {
        this.systemIsComplete && this.storeIsComplete && (this.isComplete = !0, this.queue.length > 0 && (r.each(this.queue, function(t) {
            n[t[0]].apply(n, c.call(t[1]));
        }), n.queue = []));
    }
}, r.getCustomUtmFromQuery = function(t, e, i) {
    if (!r.isObject(t)) return {};
    var a = {};
    for (var s in t) -1 !== " utm_source utm_medium utm_campaign utm_content utm_term ".indexOf(" " + s + " ") ? a[e + s] = t[s] : r.isArray(n.para.source_channel) && r.include(n.para.source_channel, s) && (a[i + s] = t[s]);
    return a;
}, r.getObjFromQuery = function(t) {
    var e = t.split("?"), n = {};
    return e && e[1] ? (r.each(e[1].split("&"), function(t) {
        var e = t.split("=");
        e[0] && e[1] && (n[e[0]] = e[1]);
    }), n) : {};
}, r.setStorageSync = function(t, e) {
    var r = function() {
        wx.setStorageSync(t, e);
    };
    try {
        r();
    } catch (t) {
        i.info("set Storage fail --", t);
        try {
            r();
        } catch (t) {
            i.info("set Storage fail again --", t);
        }
    }
}, r.getStorageSync = function(t) {
    var e = "";
    try {
        e = wx.getStorageSync(t);
    } catch (r) {
        try {
            e = wx.getStorageSync(t);
        } catch (t) {
            i.info("getStorage fail");
        }
    }
    return e;
}, r.getMPScene = function(t) {
    return "number" == typeof t || "string" == typeof t && "" !== t ? (t = String(t), 
    f[t] || t) : "未取到值";
}, r.getShareDepth = function() {
    if ("number" == typeof l && 0 !== l) {
        var t = n.store.getDistinctId(), e = n.store.getFirstId();
        return !g || g !== t && g !== e ? l + 1 : l;
    }
    return 1;
}, r.setShareInfo = function(t, e) {
    var n = {};
    if (!(t && r.isObject(t.query) && t.query.sampshare)) return {};
    if (n = r.decodeURIComponent(t.query.sampshare), !r.isJSONString(n)) return {};
    var i = (n = JSON.parse(n)).d, a = n.p, s = n.i;
    "string" == typeof s ? (e.$share_distinct_id = s, g = s) : e.$share_distinct_id = "取值异常", 
    "number" == typeof i ? (e.$share_depth = i, l = i) : e.$share_depth = "-1", e.$share_url_path = "string" == typeof a ? a : "取值异常";
}, r.getShareInfo = function() {
    return JSON.stringify({
        i: n.store.getDistinctId() || "取值异常",
        p: r.getCurrentPath(),
        d: r.getShareDepth()
    });
}, r.detectOptionQuery = function(t) {
    if (!t || !r.isObject(t.query)) return {};
    var e = {};
    return e.query = r.extend({}, t.query), "string" == typeof e.query.scene && (e.scene = e.query.scene, 
    e.query = {}, delete e.query.scene), "string" == typeof e.query.q && t.query.scancode_time && "1011" === t.scene && (e.q = e.query.q, 
    delete e.query.q, delete e.query.scancode_time), e;
}, r.getMixedQuery = function(t) {
    var e = r.detectOptionQuery(t), n = e.scene, i = e.q, a = e.query;
    return n && (n = -1 !== (n = r.decodeURIComponent(n)).indexOf("?") ? "?" + n.replace(/\?/g, "") : "?" + n, 
    r.extend(a, r.getObjFromQuery(n))), i && r.extend(a, r.getObjFromQuery(r.decodeURIComponent(i))), 
    a;
}, r.setUtm = function(t, e) {
    var n = {}, i = r.getMixedQuery(t), a = r.getCustomUtmFromQuery(i, "$", "_"), s = r.getCustomUtmFromQuery(i, "$latest_", "_latest_");
    return n.pre1 = a, n.pre2 = s, r.extend(e, a), n;
}, r.wxrequest = function(t) {
    var e = wx.request(t);
    setTimeout(function() {
        r.isObject(e) && r.isFunction(e.abort) && e.abort();
    }, n.para.datasend_timeout);
}, r.info = {
    currentProps: {},
    properties: {
        $lib: "MiniProgram",
        $lib_version: String("1.13.8")
    },
    getSystem: function() {
        var t = this.properties;
        wx.getNetworkType({
            success: function(e) {
                t.$network_type = e.networkType;
            },
            complete: function() {
                wx.getSystemInfo({
                    success: function(e) {
                        var r, n;
                        t.$manufacturer = e.brand, t.$model = e.model, t.$screen_width = Number(e.screenWidth), 
                        t.$screen_height = Number(e.screenHeight), t.$os = (r = e.platform, "ios" === (n = r.toLowerCase()) ? "iOS" : "android" === n ? "Android" : r), 
                        t.$os_version = e.system.indexOf(" ") > -1 ? e.system.split(" ")[1] : e.system;
                    },
                    complete: function() {
                        n.initialState.systemIsComplete = !0, n.initialState.checkIsComplete();
                    }
                });
            }
        });
    }
}, n._ = r, n.prepareData = function(t, a) {
    var s = {
        distinct_id: this.store.getDistinctId(),
        lib: {
            $lib: "MiniProgram",
            $lib_method: "code",
            $lib_version: String("1.13.8")
        },
        properties: {}
    };
    r.extend(s, t), r.isObject(t.properties) && !r.isEmptyObject(t.properties) && r.extend(s.properties, t.properties), 
    t.type && "profile" === t.type.slice(0, 7) || (n.para.batch_send && (s._track_id = Number(String(Math.random()).slice(2, 5) + String(Math.random()).slice(2, 4) + String(Date.now()).slice(-4))), 
    s.properties = r.extend({}, r.info.properties, n.store.getProps(), r.info.currentProps, s.properties), 
    "object" == e(n.store._state) && "number" == typeof n.store._state.first_visit_day_time && n.store._state.first_visit_day_time > new Date().getTime() ? s.properties.$is_first_day = !0 : s.properties.$is_first_day = !1), 
    s.properties.$time && r.isDate(s.properties.$time) ? (s.time = 1 * s.properties.$time, 
    delete s.properties.$time) : n.para.use_client_time && (s.time = 1 * new Date()), 
    r.searchObjDate(s), r.searchObjString(s), i.info(s), n.sendStrategy.send(s);
}, n.store = {
    verifyDistinctId: function(t) {
        return "number" == typeof t && (t = String(t), /^\d+$/.test(t) || (t = "unexpected_id")), 
        "string" == typeof t && "" !== t || (t = "unexpected_id"), t;
    },
    storageInfo: null,
    getUUID: function() {
        return Date.now() + "-" + Math.floor(1e7 * Math.random()) + "-" + Math.random().toString(16).replace(".", "") + "-" + String(31242 * Math.random()).replace(".", "").slice(0, 8);
    },
    getStorage: function() {
        return this.storageInfo ? this.storageInfo : (this.storageInfo = n._.getStorageSync("sensorsdata2015_wechat") || "", 
        this.storageInfo);
    },
    _state: {},
    mem: {
        mdata: [],
        getLength: function() {
            return this.mdata.length;
        },
        add: function(t) {
            this.mdata.push(t);
        },
        clear: function(t) {
            this.mdata.splice(0, t);
        }
    },
    toState: function(t) {
        var e = null;
        r.isJSONString(t) ? (e = JSON.parse(t)).distinct_id ? this._state = e : this.set("distinct_id", this.getUUID()) : r.isObject(t) && (e = t).distinct_id ? this._state = e : this.set("distinct_id", this.getUUID());
    },
    getFirstId: function() {
        return this._state.first_id;
    },
    getDistinctId: function() {
        return this._state.distinct_id;
    },
    getProps: function() {
        return this._state.props || {};
    },
    setProps: function(t, e) {
        var n = this._state.props || {};
        e ? this.set("props", t) : (r.extend(n, t), this.set("props", n));
    },
    set: function(t, r) {
        var n = {};
        for (var i in "string" == typeof t ? n[t] = r : "object" == (void 0 === t ? "undefined" : e(t)) && (n = t), 
        this._state = this._state || {}, n) this._state[i] = n[i];
        this.save();
    },
    change: function(t, e) {
        this._state[t] = e;
    },
    save: function() {
        n._.setStorageSync("sensorsdata2015_wechat", this._state);
    },
    init: function() {
        var t = this.getStorage();
        if (t) this.toState(t); else {
            m = !0;
            var e = new Date(), r = e.getTime();
            e.setHours(23), e.setMinutes(59), e.setSeconds(60), n.setOnceProfile({
                $first_visit_time: new Date()
            }), this.set({
                distinct_id: this.getUUID(),
                first_visit_time: r,
                first_visit_day_time: e.getTime()
            });
        }
    }
}, n.setProfile = function(t, e) {
    n.prepareData({
        type: "profile_set",
        properties: t
    }, e);
}, n.setOnceProfile = function(t, e) {
    n.prepareData({
        type: "profile_set_once",
        properties: t
    }, e);
}, n.appendProfile = function(t, e) {
    if (!r.isObject(t)) return !1;
    r.each(t, function(e, n) {
        r.isString(e) ? t[n] = [ e ] : r.isArray(e) || (delete t[n], i.info("appendProfile属性的值必须是字符串或者数组"));
    }), n.prepareData({
        type: "profile_append",
        properties: t
    }, e);
}, n.incrementProfile = function(t, e) {
    if (!r.isObject(t)) return !1;
    var i = t;
    r.isString(t) && ((t = {})[i] = 1), n.prepareData({
        type: "profile_increment",
        properties: t
    }, e);
}, n.track = function(t, e, r) {
    this.prepareData({
        type: "track",
        event: t,
        properties: e
    }, r);
}, n.identify = function(t, e) {
    if ("string" != typeof t && "number" != typeof t) return !1;
    t = n.store.verifyDistinctId(t);
    var r = n.store.getFirstId();
    !0 === e ? r ? n.store.set("first_id", t) : n.store.set("distinct_id", t) : r ? n.store.change("first_id", t) : n.store.change("distinct_id", t);
}, n.trackSignup = function(t, e, r, i) {
    n.prepareData({
        original_id: n.store.getFirstId() || n.store.getDistinctId(),
        distinct_id: t,
        type: "track_signup",
        event: e,
        properties: r
    }, i), n.store.set("distinct_id", t);
}, n.registerApp = function(t) {
    r.isObject(t) && !r.isEmptyObject(t) && (r.info.currentProps = r.extend(r.info.currentProps, t));
}, n.register = function(t) {
    r.isObject(t) && !r.isEmptyObject(t) && n.store.setProps(t);
}, n.clearAllRegister = function() {
    n.store.setProps({}, !0);
}, n.login = function(t) {
    if ("string" != typeof t && "number" != typeof t) return !1;
    t = n.store.verifyDistinctId(t);
    var e = n.store.getFirstId(), r = n.store.getDistinctId();
    t !== r && (e ? n.trackSignup(t, "$SignUp") : (n.store.set("first_id", r), n.trackSignup(t, "$SignUp")));
}, n.openid = {
    getRequest: function(t) {
        wx.login({
            success: function(e) {
                e.code && n.para.appid && n.para.openid_url ? r.wxrequest({
                    url: n.para.openid_url + "&code=" + e.code + "&appid=" + n.para.appid,
                    method: "GET",
                    complete: function(e) {
                        r.isObject(e) && r.isObject(e.data) && e.data.openid ? t(e.data.openid) : t();
                    }
                }) : t();
            }
        });
    },
    getWXStorage: function() {
        var t = n.store.getStorage();
        if (t && r.isObject(t)) return t.openid;
    },
    getOpenid: function(t) {
        if (!n.para.appid) return t(), !1;
        var e = this.getWXStorage();
        e ? t(e) : this.getRequest(t);
    }
}, n.initial = function() {
    this._.info.getSystem(), this.store.init();
}, n.init = function(t) {
    if (!0 === this.hasInit) return !1;
    this.hasInit = !0, n.setPara(t), n.para.batch_send && n.sendStrategy.batchInterval(), 
    n.initialState.storeIsComplete = !0, n.initialState.checkIsComplete();
}, n.getPresetProperties = function() {
    if (r.info && r.info.properties && r.info.properties.$lib) {
        var t = {};
        r.each(r.info.currentProps, function(e, r) {
            0 === r.indexOf("$") && (t[r] = e);
        });
        var e = r.extend(t, {
            $url_path: r.getCurrentPath()
        }, r.info.properties, n.store.getProps());
        return delete e.$lib, e;
    }
    return {};
}, r.autoExeQueue = function() {
    return {
        items: [],
        enqueue: function(t) {
            this.items.push(t), this.start();
        },
        dequeue: function() {
            return this.items.shift();
        },
        getCurrentItem: function() {
            return this.items[0];
        },
        isRun: !1,
        start: function() {
            this.items.length > 0 && !this.isRun && (this.isRun = !0, this.getCurrentItem().start());
        },
        close: function() {
            this.dequeue(), this.isRun = !1, this.start();
        }
    };
}, n.requestQueue = function(t) {
    this.url = t.url;
}, n.requestQueue.prototype.isEnd = function() {
    this.received || (this.received = !0, this.close());
}, n.requestQueue.prototype.start = function() {
    var t = this;
    setTimeout(function() {
        t.isEnd();
    }, n.para.send_timeout), r.wxrequest({
        url: this.url,
        method: "GET",
        complete: function() {
            t.isEnd();
        }
    });
}, n.dataQueue = r.autoExeQueue(), n.sendStrategy = {
    dataHasSend: !0,
    dataHasChange: !1,
    onAppHide: function() {
        n.para.batch_send && this.batchSend();
    },
    send: function(t) {
        if (n.para.batch_send) {
            if (this.dataHasChange = !0, n.store.mem.getLength() >= 300) return i.info("数据量存储过大，有异常"), 
            !1;
            n.store.mem.add(t), n.store.mem.getLength() >= n.para.batch_send.max_length && this.batchSend();
        } else this.queueSend(t);
    },
    queueSend: function(t) {
        t = JSON.stringify(t), t = -1 !== n.para.server_url.indexOf("?") ? n.para.server_url + "&data=" + encodeURIComponent(r.base64Encode(t)) : n.para.server_url + "?data=" + encodeURIComponent(r.base64Encode(t));
        var e = new n.requestQueue({
            url: t
        });
        e.close = function() {
            n.dataQueue.close();
        }, n.dataQueue.enqueue(e);
    },
    wxrequest: function(t) {
        if (r.isArray(t.data) && t.data.length > 0) {
            var e = Date.now();
            t.data.forEach(function(t) {
                t._flush_time = e;
            }), t.data = JSON.stringify(t.data), r.wxrequest({
                url: n.para.server_url,
                method: "POST",
                dataType: "text",
                data: "data_list=" + encodeURIComponent(r.base64Encode(t.data)),
                success: function() {
                    t.success(t.len);
                }
            });
        } else t.success(t.len);
    },
    batchSend: function() {
        if (this.dataHasSend) {
            var t = n.store.mem.mdata, e = t.length;
            e > 0 && (this.dataHasSend = !1, this.wxrequest({
                data: t,
                len: e,
                success: this.batchRemove.bind(this)
            }));
        }
    },
    batchRemove: function(t) {
        n.store.mem.clear(t), this.dataHasSend = !0, this.dataHasChange = !0, this.batchWrite();
    },
    is_first_batch_write: !0,
    batchWrite: function() {
        var t = this;
        this.dataHasChange && (this.is_first_batch_write && (this.is_first_batch_write = !1, 
        setTimeout(function() {
            t.batchSend();
        }, 1e3)), this.dataHasChange = !1, n._.setStorageSync("sensors_mp_prepare_data", n.store.mem.mdata));
    },
    batchInterval: function() {
        var t = this;
        !function e() {
            setTimeout(function() {
                t.batchWrite(), e();
            }, 500);
        }(), function e() {
            setTimeout(function() {
                t.batchSend(), e();
            }, n.para.batch_send.send_timeout);
        }();
    }
}, n.setOpenid = function(t, e) {
    n.store.set("openid", t), e ? n.store.set("distinct_id", t) : n.identify(t, !0);
}, n.initWithOpenid = function(t, e) {
    (t = t || {}).appid && (n.para.appid = t.appid), n.openid.getOpenid(function(i) {
        i && n.setOpenid(i, t.isCoverLogin), e && r.isFunction(e) && e(i), n.init(t);
    });
}, r.each([ "setProfile", "setOnceProfile", "track", "register", "clearAllRegister", "quick", "incrementProfile", "appendProfile" ], function(t) {
    var e = n[t];
    n[t] = function() {
        n.initialState.isComplete ? e.apply(n, arguments) : n.initialState.queue.push([ t, arguments ]);
    };
}), r.setQuery = function(t) {
    if (t && r.isObject(t) && !r.isEmptyObject(t)) {
        var e = [];
        return r.each(t, function(t, n) {
            "q" === n && r.isString(t) && 0 === t.indexOf("http") || "scene" === n || e.push(n + "=" + t);
        }), e.join("&");
    }
    return "";
}, r.getUtmFromPage = function() {
    var t = {};
    try {
        var e = getCurrentPages(), n = e[e.length - 1].options;
        t = r.getCustomUtmFromQuery(n, "$", "_");
    } catch (t) {
        i.info(t);
    }
    return t;
}, n.autoTrackCustom = {
    trackCustom: function(t, e, i) {
        var a = n.para.autoTrack[t], s = "";
        n.para.autoTrack && a && ("function" == typeof a ? (s = a(), r.isObject(s) && r.extend(e, s)) : r.isObject(a) && (r.extend(e, a), 
        n.para.autoTrack[t] = !0), n.track(i, e));
    },
    appLaunch: function(t, i) {
        "object" != e(this) || this.trackCustom || (this[n.para.name] = n);
        var a = {};
        t && t.path && (a.$url_path = r.getPath(t.path)), r.setShareInfo(t, a);
        var s = r.setUtm(t, a);
        m ? (a.$is_first_time = !0, r.isEmptyObject(s.pre1) || n.setOnceProfile(s.pre1)) : a.$is_first_time = !1, 
        r.isEmptyObject(s.pre2) || n.registerApp(s.pre2), t.scene = t.scene || "未取到值", a.$scene = r.getMPScene(t.scene), 
        n.registerApp({
            $latest_scene: a.$scene
        }), a.$url_query = r.setQuery(t.query), i ? (a = r.extend(a, i), n.track("$MPLaunch", a)) : n.para.autoTrack && n.para.autoTrack.appLaunch && n.autoTrackCustom.trackCustom("appLaunch", a, "$MPLaunch");
    },
    appShow: function(t, e) {
        var i = {};
        d = new Date().getTime(), t && t.path && (i.$url_path = r.getPath(t.path)), r.setShareInfo(t, i);
        var a = r.setUtm(t, i);
        r.isEmptyObject(a.pre2) || n.registerApp(a.pre2), t.scene = t.scene || "未取到值", i.$scene = r.getMPScene(t.scene), 
        n.registerApp({
            $latest_scene: i.$scene
        }), i.$url_query = r.setQuery(t.query), e ? (i = r.extend(i, e), n.track("$MPShow", i)) : n.para.autoTrack && n.para.autoTrack.appShow && n.autoTrackCustom.trackCustom("appShow", i, "$MPShow");
    },
    appHide: function(t) {
        var e = new Date().getTime(), i = {};
        i.$url_path = r.getCurrentPath(), d && e - d > 0 && (e - d) / 36e5 < 24 && (i.event_duration = (e - d) / 1e3), 
        t ? (i = r.extend(i, t), n.track("$MPHide", i)) : n.para.autoTrack && n.para.autoTrack.appHide && n.autoTrackCustom.trackCustom("appHide", i, "$MPHide"), 
        n.sendStrategy.onAppHide();
    },
    pageLoad: function(t) {
        t && r.isObject(t) && (this.sensors_mp_url_query = r.setQuery(t));
    },
    pageShow: function(t) {
        var e = {}, i = r.getCurrentPath();
        e.$referrer = h, e.$url_path = i, n.status.last_referrer = h, e.$url_query = this.sensors_mp_url_query ? this.sensors_mp_url_query : "", 
        e = r.extend(e, r.getUtmFromPage()), t ? (e = r.extend(e, t), n.track("$MPViewScreen", e)) : n.para.onshow ? n.para.onshow(n, i, this) : n.para.autoTrack && n.para.autoTrack.pageShow && n.autoTrackCustom.trackCustom("pageShow", e, "$MPViewScreen"), 
        h = i, n.status.referrer = i;
    },
    pageShare: function(t, i) {
        var a = t.onShareAppMessage;
        t.onShareAppMessage = function() {
            var t = a.apply(this, arguments);
            return n.para.autoTrack && n.para.autoTrack.pageShare && n.autoTrackCustom.trackCustom("pageShare", {
                $url_path: r.getCurrentPath(),
                $share_depth: r.getShareDepth()
            }, "$MPShare"), n.para.allow_amend_share_path && ("object" != (void 0 === t ? "undefined" : e(t)) && ((t = {}).path = r.getCurrentUrl(this)), 
            "object" != (void 0 === t ? "undefined" : e(t)) || void 0 !== t.path && "" !== t.path || (t.path = r.getCurrentUrl(this)), 
            "object" == (void 0 === t ? "undefined" : e(t)) && "string" == typeof t.path && (-1 === t.path.indexOf("?") ? t.path = t.path + "?" : "&" !== t.path.slice(-1) && (t.path = t.path + "&")), 
            t.path = t.path + "sampshare=" + encodeURIComponent(r.getShareInfo())), t;
        };
    }
}, n.quick = function() {
    var t = arguments[0], e = arguments[1], a = arguments[2], s = r.isObject(a) ? a : {};
    if ("getAnonymousID" === t) {
        if (!r.isEmptyObject(n.store._state)) return n.store._state.first_id ? n.store._state.first_id : n.store._state.distinct_id;
        i.info("请先初始化SDK");
    } else "appLaunch" === t || "appShow" === t ? e ? n.autoTrackCustom[t](e, s) : i.info("App的launch和show，在sensors.quick第二个参数必须传入App的options参数") : "appHide" === t && (s = r.isObject(e) ? e : {}, 
    n.autoTrackCustom[t](s));
};

var _ = App;

App = function(e) {
    t(e, "onLaunch", "appLaunch"), t(e, "onShow", "appShow"), t(e, "onHide", "appHide"), 
    _.apply(this, arguments);
};

var y = Page;

Page = function(e) {
    t(e, "onLoad", "pageLoad"), t(e, "onShow", "pageShow"), "function" == typeof e.onShareAppMessage && n.autoTrackCustom.pageShare(e), 
    y.apply(this, arguments);
};

var S = Component;

Component = function(e) {
    try {
        var r = e.methods || {};
        t(r, "onLoad", "pageLoad"), t(r, "onShow", "pageShow"), "function" == typeof r.onShareAppMessage && n.autoTrackCustom.pageShare(e.methods), 
        S.apply(this, arguments);
    } catch (e) {
        S.apply(this, arguments);
    }
}, n.initial(), module.exports = n;